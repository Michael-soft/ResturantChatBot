{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate,useLocation}from'react-router-dom';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function PaymentPage(){const[orderDetails,setOrderDetails]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const navigate=useNavigate();const location=useLocation();useEffect(()=>{const fetchOrderDetails=async()=>{try{// Get order ID and amount from URL parameters\nconst params=new URLSearchParams(location.search);const orderId=params.get('orderId');const amount=params.get('amount');if(!orderId||!amount){setError('Missing order details');setLoading(false);return;}// Set order details from URL parameters\nsetOrderDetails({orderId,totalAmount:parseFloat(amount)});setLoading(false);}catch(err){console.error('Error processing order details:',err);setError('Failed to process order details');setLoading(false);}};fetchOrderDetails();},[location]);const handlePayment=async()=>{try{setLoading(true);// Format amount to the smallest currency unit (kobo for NGN, cents for USD)\n// Paystack expects amount in kobo (1 Naira = 100 kobo)\nconst amount=orderDetails.totalAmount;amount;// Initialize payment with Paystack\nconst response=await axios.post('http://localhost:3001/api/payment/initialize',{orderId:orderDetails.orderId,amount:amount,email:'customer@example.com',// You can make this dynamic\ncallbackUrl:`${window.location.origin}/chat?payment=success&orderId=${orderDetails.orderId}`});if(response.data&&response.data.authorization_url){// Redirect to Paystack payment page\nwindow.location.href=response.data.authorization_url;}else{console.error('Payment initialization response:',response.data);throw new Error('Invalid payment initialization response');}}catch(err){var _err$response,_err$response$data,_err$response2,_err$response2$data;console.error('Error initializing payment:',err);// More detailed error message\nconst errorMessage=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||'Payment could not be processed. Please try again later.';setError(errorMessage);setLoading(false);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'20px'},children:/*#__PURE__*/_jsx(\"h2\",{children:\"Loading payment details...\"})});}if(error){return/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',padding:'20px'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:'red'},children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),style:{padding:'10px 20px',backgroundColor:'#007bff',color:'white',border:'none',borderRadius:'4px',cursor:'pointer',marginTop:'20px'},children:\"Return to Chat\"})]});}return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:'600px',margin:'0 auto',padding:'20px'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Payment\"}),orderDetails&&/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #ddd',borderRadius:'8px',padding:'20px',marginTop:'20px'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Order Details\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Order ID:\"}),\" \",orderDetails.orderId]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Amount:\"}),\" \\u20A6\",orderDetails.totalAmount.toFixed(2)]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'20px'},children:/*#__PURE__*/_jsx(\"button\",{onClick:handlePayment,disabled:loading,style:{padding:'10px 20px',backgroundColor:'#28a745',color:'white',border:'none',borderRadius:'4px',cursor:loading?'not-allowed':'pointer',fontSize:'16px',fontWeight:'bold',opacity:loading?0.7:1},children:loading?'Processing...':'Pay with Paystack'})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),style:{padding:'10px 20px',backgroundColor:'#6c757d',color:'white',border:'none',borderRadius:'4px',cursor:'pointer',marginTop:'20px'},children:\"Cancel Payment\"})]});}export default PaymentPage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useLocation","axios","jsx","_jsx","jsxs","_jsxs","PaymentPage","orderDetails","setOrderDetails","loading","setLoading","error","setError","navigate","location","fetchOrderDetails","params","URLSearchParams","search","orderId","get","amount","totalAmount","parseFloat","err","console","handlePayment","response","post","email","callbackUrl","window","origin","data","authorization_url","href","Error","_err$response","_err$response$data","_err$response2","_err$response2$data","errorMessage","message","style","textAlign","padding","children","color","onClick","backgroundColor","border","borderRadius","cursor","marginTop","maxWidth","margin","toFixed","disabled","fontSize","fontWeight","opacity"],"sources":["C:/Users/tosin/OneDrive/Desktop/Third Semster Assesment/Restaurant ChatBot/frontend/src/components/PaymentPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\nfunction PaymentPage() {\r\n  const [orderDetails, setOrderDetails] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  useEffect(() => {\r\n    const fetchOrderDetails = async () => {\r\n      try {\r\n        // Get order ID and amount from URL parameters\r\n        const params = new URLSearchParams(location.search);\r\n        const orderId = params.get('orderId');\r\n        const amount = params.get('amount');\r\n        \r\n        if (!orderId || !amount) {\r\n          setError('Missing order details');\r\n          setLoading(false);\r\n          return;\r\n        }\r\n\r\n        // Set order details from URL parameters\r\n        setOrderDetails({\r\n          orderId,\r\n          totalAmount: parseFloat(amount)\r\n        });\r\n        setLoading(false);\r\n      } catch (err) {\r\n        console.error('Error processing order details:', err);\r\n        setError('Failed to process order details');\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchOrderDetails();\r\n  }, [location]);\r\n\r\n  const handlePayment = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Format amount to the smallest currency unit (kobo for NGN, cents for USD)\r\n      // Paystack expects amount in kobo (1 Naira = 100 kobo)\r\n      const amount = orderDetails.totalAmount;\r\n       amount      \r\n      // Initialize payment with Paystack\r\n      const response = await axios.post('http://localhost:3001/api/payment/initialize', {\r\n        orderId: orderDetails.orderId,\r\n        amount: amount,\r\n        email: 'customer@example.com', // You can make this dynamic\r\n        callbackUrl: `${window.location.origin}/chat?payment=success&orderId=${orderDetails.orderId}`\r\n      });\r\n\r\n      if (response.data && response.data.authorization_url) {\r\n        // Redirect to Paystack payment page\r\n        window.location.href = response.data.authorization_url;\r\n      } else {\r\n        console.error('Payment initialization response:', response.data);\r\n        throw new Error('Invalid payment initialization response');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error initializing payment:', err);\r\n      // More detailed error message\r\n      const errorMessage = err.response?.data?.message || \r\n                           err.response?.data?.error || \r\n                           'Payment could not be processed. Please try again later.';\r\n      setError(errorMessage);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div style={{ textAlign: 'center', padding: '20px' }}>\r\n        <h2>Loading payment details...</h2>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div style={{ textAlign: 'center', padding: '20px' }}>\r\n        <h2 style={{ color: 'red' }}>{error}</h2>\r\n        <button \r\n          onClick={() => navigate('/')}\r\n          style={{\r\n            padding: '10px 20px',\r\n            backgroundColor: '#007bff',\r\n            color: 'white',\r\n            border: 'none',\r\n            borderRadius: '4px',\r\n            cursor: 'pointer',\r\n            marginTop: '20px'\r\n          }}\r\n        >\r\n          Return to Chat\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ maxWidth: '600px', margin: '0 auto', padding: '20px' }}>\r\n      <h2>Order Payment</h2>\r\n      \r\n      {orderDetails && (\r\n        <div style={{ \r\n          border: '1px solid #ddd', \r\n          borderRadius: '8px', \r\n          padding: '20px',\r\n          marginTop: '20px'\r\n        }}>\r\n          <h3>Order Details</h3>\r\n          <p><strong>Order ID:</strong> {orderDetails.orderId}</p>\r\n          <p><strong>Total Amount:</strong> â‚¦{orderDetails.totalAmount.toFixed(2)}</p>\r\n          \r\n          <div style={{ marginTop: '20px' }}>\r\n            <button\r\n              onClick={handlePayment}\r\n              disabled={loading}\r\n              style={{\r\n                padding: '10px 20px',\r\n                backgroundColor: '#28a745',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: loading ? 'not-allowed' : 'pointer',\r\n                fontSize: '16px',\r\n                fontWeight: 'bold',\r\n                opacity: loading ? 0.7 : 1\r\n              }}\r\n            >\r\n              {loading ? 'Processing...' : 'Pay with Paystack'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      <button \r\n        onClick={() => navigate('/')}\r\n        style={{\r\n          padding: '10px 20px',\r\n          backgroundColor: '#6c757d',\r\n          color: 'white',\r\n          border: 'none',\r\n          borderRadius: '4px',\r\n          cursor: 'pointer',\r\n          marginTop: '20px'\r\n        }}\r\n      >\r\n        Cancel Payment\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default PaymentPage; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}